"use strict";!function(angular){angular.module("ngWYSIWYG",["ngSanitize"]);var editorTemplate='<div class="tinyeditor"><div class="tinyeditor-header" ng-hide="editMode">{toolbar}<div style="clear: both;"></div></div><div class="sizer" ce-resize><textarea data-placeholder-attr="" style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; resize: none; width: 100%; height: 100%;" ng-show="editMode" ng-model="content"></textarea><iframe style="-webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; width: 100%; height: 100%;" ng-hide="editMode" wframe="{sanitize: config.sanitize}" content-style="{contentStyle}" ng-model="content"></iframe></div><div class="tinyeditor-footer"><div ng-switch="editMode" ng-click="editMode = !editMode" class="toggle"><span ng-switch-when="true">wysiwyg</span><span ng-switch-default>source</span></div></div></div>';angular.module("ngWYSIWYG").config(["$provide",function($provide){$provide.decorator("$sanitize",function($delegate,$log){return function(text,target){var result=$delegate(text,target);return result}})}]),angular.module("ngWYSIWYG").directive("wframe",["$compile","$timeout","$sanitize",function($compile,$timeout,$sanitize){var linker=function(scope,$element,attrs,ctrl){var $document=$element[0].contentDocument;$document.open(),$document.write('<!DOCTYPE html><html><head></head><body contenteditable="true"></body></html>'),$document.close(),$document.designMode="On";var $body=angular.element($element[0].contentDocument.body),$head=angular.element($element[0].contentDocument.head);$body.attr("contenteditable","true"),$document.addEventListener("click",function(event){"HTML"===event.target.tagName&&event.target.querySelector("body").focus()}),attrs.contentStyle&&$head.append('<link rel="stylesheet" type="text/css" href="'+attrs.contentStyle+'">'),ctrl.$render=function(){console.log(scope.config),$body[0].innerHTML=ctrl.$viewValue?scope.config&&scope.config.sanitize?$sanitize(ctrl.$viewValue):ctrl.$viewValue:""},scope.sync=function(){scope.$evalAsync(function(scope){ctrl.$setViewValue($body.html())})};var getSelectionBoundaryElement=function(win,isStart){var range,sel,container=null,doc=win.document;return doc.selection?(range=doc.selection.createRange(),range.collapse(isStart),range.parentElement()):(doc.getSelection?(sel=doc.getSelection(),sel.rangeCount>0&&(range=sel.getRangeAt(0),container=range[isStart?"startContainer":"endContainer"],3===container.nodeType&&(container=container.parentNode))):win.getSelection&&(sel=win.getSelection(),sel.rangeCount>0&&(range=sel.getRangeAt(0),container=range[isStart?"startContainer":"endContainer"],3===container.nodeType&&(container=container.parentNode))),container)},debounce=null;$body.bind("click keyup change paste",function(){debounce&&$timeout.cancel(debounce),debounce=$timeout(function(){ctrl.$setViewValue($body.html());var el=getSelectionBoundaryElement($element[0].contentWindow,!0);if(el){var computedStyle=$element[0].contentWindow.getComputedStyle(el),elementStyle={bold:"bold"==computedStyle.getPropertyValue("font-weight")||parseInt(computedStyle.getPropertyValue("font-weight"))>=700,italic:"italic"==computedStyle.getPropertyValue("font-style"),underline:"underline"==computedStyle.getPropertyValue("text-decoration"),strikethrough:"line-through"==computedStyle.getPropertyValue("text-decoration"),font:computedStyle.getPropertyValue("font-family"),size:parseInt(computedStyle.getPropertyValue("font-size")),color:computedStyle.getPropertyValue("color"),sub:"sub"==computedStyle.getPropertyValue("vertical-align"),"super":"super"==computedStyle.getPropertyValue("vertical-align"),background:computedStyle.getPropertyValue("background-color"),alignment:computedStyle.getPropertyValue("text-align")};scope.$emit("cursor-position",elementStyle)}},100,!0)}),scope.range=null,scope.getSelection=function(){if($document.getSelection){var sel=$document.getSelection();sel.getRangeAt&&sel.rangeCount&&(scope.range=sel.getRangeAt(0))}},scope.restoreSelection=function(){if(scope.range&&$document.getSelection){var sel=$document.getSelection();sel.removeAllRanges(),sel.addRange(scope.range)}},scope.$on("execCommand",function(e,cmd){console.log("execCommand: "),console.log(cmd),$element[0].contentDocument.body.focus();var sel=$document.selection;if(sel){var textRange=sel.createRange();$document.execCommand(cmd.command,0,cmd.arg),textRange.collapse(!1),textRange.select()}else $document.execCommand(cmd.command,0,cmd.arg);$document.body.focus(),scope.sync()}),scope.$on("$destroy",function(){});try{$document.execCommand("styleWithCSS",0,0),$document.execCommand("enableObjectResizing",0,!0),$document.execCommand("contentReadOnly",0,"false")}catch(e){try{$document.execCommand("useCSS",0,1)}catch(e){}}};return{link:linker,require:"ngModel",scope:{config:"=wframe"},replace:!0,restrict:"AE"}}]),angular.module("ngWYSIWYG").directive("ceResize",["$document",function($document){return function($scope,$element,$attr){var $mouseDown,resizeDown=function($event){var margin=50,uppest=$element[0].offsetTop+margin,height=$event.pageY>uppest?$event.pageY-$element[0].offsetTop:margin;$element.css({height:height+"px"})},createResizer=function(className,handlers){var newElement=angular.element('<span class="'+className+'"></span>');$element.append(newElement),newElement.on("mousedown",function($event){function mousemove($event){$event.preventDefault();for(var i=0;i<handlers.length;i++)handlers[i]($event)}function mouseup(){$document.off("mousemove",mousemove),$document.off("mouseup",mouseup)}$document.on("mousemove",mousemove),$document.on("mouseup",mouseup),$mouseDown=$event,$mouseDown.top=$element[0].offsetTop,$mouseDown.left=$element[0].offsetLeft,$mouseDown.width=$element[0].offsetWidth,$mouseDown.height=$element[0].offsetHeight})};createResizer("resizer",[resizeDown,resizeDown])}}]),angular.module("ngWYSIWYG").directive("colorsGrid",["$compile","$document",function($compile,$document){var linker=function(scope,element,attrs,ctrl){$document.on("click",function(){scope.$apply(function(){scope.show=!1})}),element.parent().bind("click",function(e){e.stopPropagation()}),scope.colors=["#000000","#993300","#333300","#003300","#003366","#000080","#333399","#333333","#800000","#FF6600","#808000","#008000","#008080","#0000FF","#666699","#808080","#FF0000","#FF9900","#99CC00","#339966","#33CCCC","#3366FF","#800080","#999999","#FF00FF","#FFCC00","#FFFF00","#00FF00","#00FFFF","#00CCFF","#993366","#C0C0C0","#FF99CC","#FFCC99","#FFFF99","#CCFFCC","#CCFFFF","#99CCFF","#CC99FF","#FFFFFF"],scope.pick=function(color){scope.onPick({color:color})},element.ready(function(){function makeUnselectable(node){1==node.nodeType&&(node.setAttribute("unselectable","on"),node.unselectable="on");for(var child=node.firstChild;child;)makeUnselectable(child),child=child.nextSibling}for(var i=0;i<document.getElementsByClassName("colors-grid").length;i+=1)makeUnselectable(document.getElementsByClassName("colors-grid")[i])})};return{link:linker,scope:{show:"=",onPick:"&"},restrict:"AE",template:'<ul ng-show="show" class="colors-grid"><li ng-style="{\'background-color\': color}" title: "{{color}}" ng-repeat="color in colors" unselectable="on" ng-click="pick(color)"></li></ul>'}}]),angular.module("ngWYSIWYG").directive("symbolsGrid",["$compile","$document","$sce",function($compile,$document,$sce){var linker=function(scope,element,attrs,ctrl){$document.on("click",function(){scope.$apply(function(){scope.show=!1})}),element.parent().bind("click",function(e){e.stopPropagation()}),scope.symbols=["&iexcl;","&iquest;","&ndash;","&mdash;","&raquo;","&laquo;","&copy;","&divide;","&micro;","&para;","&plusmn;","&cent;","&euro;","&pound;","&reg;","&sect;","&trade;","&yen;","&deg;","&forall;","&part;","&exist;","&empty;","&nabla;","&isin;","&notin;","&ni;","&prod;","&sum;","&uarr;","&rarr;","&darr;","&spades;","&clubs;","&hearts;","&diams;","&aacute;","&agrave;","&acirc;","&aring;","&atilde;","&auml;","&aelig;","&ccedil;","&eacute;","&egrave;","&ecirc;","&euml;","&iacute;","&igrave;","&icirc;","&iuml;","&ntilde;","&oacute;","&ograve;","&ocirc;","&oslash;","&otilde;","&ouml;","&szlig;","&uacute;","&ugrave;","&ucirc;","&uuml;","&yuml;"],scope.pick=function(symbol){scope.onPick({symbol:symbol})},element.ready(function(){function makeUnselectable(node){1==node.nodeType&&(node.setAttribute("unselectable","on"),node.unselectable="on");for(var child=node.firstChild;child;)makeUnselectable(child),child=child.nextSibling}for(var i=0;i<document.getElementsByClassName("symbols-grid").length;i+=1)makeUnselectable(document.getElementsByClassName("symbols-grid")[i])})};return{link:linker,scope:{show:"=",onPick:"&"},restrict:"AE",template:'<ul ng-show="show" class="symbols-grid"><li ng-repeat="symbol in symbols" unselectable="on" ng-click="pick(symbol)" ng-bind-html="symbol"></li></ul>'}}]),angular.module("ngWYSIWYG").directive("wysiwygEdit",["$compile","$timeout","$q",function($compile,$timeout,$q){var linker=function(scope,$element,attrs,ctrl){scope.editMode=!1,scope.cursorStyle={},scope.panelButtons={"-":'<div class="tinyeditor-divider"></div>',bold:'<div class="tinyeditor-control" title="Bold" style="background-position: 34px -120px;" ng-class="{\'pressed\': cursorStyle.bold}" ng-click="execCommand(\'bold\')"></div>',italic:'<div class="tinyeditor-control" title="Italic" style="background-position: 34px -150px;" ng-class="{\'pressed\': cursorStyle.italic}" ng-click="execCommand(\'italic\')"></div>',underline:'<div class="tinyeditor-control" title="Underline" style="background-position: 34px -180px;" ng-class="{\'pressed\': cursorStyle.underline}" ng-click="execCommand(\'underline\')"></div>',strikethrough:'<div class="tinyeditor-control" title="Strikethrough" style="background-position: 34px -210px;" ng-class="{\'pressed\': cursorStyle.strikethrough}" ng-click="execCommand(\'strikethrough\')"></div>',subscript:'<div class="tinyeditor-control" title="Subscript" style="background-position: 34px -240px;" ng-class="{\'pressed\': cursorStyle.sub}"ng-click="execCommand(\'subscript\')"></div>',superscript:'<div class="tinyeditor-control" title="Superscript" style="background-position: 34px -270px;" ng-class="{\'pressed\': cursorStyle.super}" ng-click="execCommand(\'superscript\')"></div>',leftAlign:'<div class="tinyeditor-control" title="Left Align" style="background-position: 34px -420px;" ng-class="{\'pressed\': cursorStyle.alignment == \'left\'}" ng-click="execCommand(\'justifyleft\')"></div>',centerAlign:'<div class="tinyeditor-control" title="Center Align" style="background-position: 34px -450px;" ng-class="{\'pressed\': cursorStyle.alignment == \'center\'}" ng-click="execCommand(\'justifycenter\')"></div>',rightAlign:'<div class="tinyeditor-control" title="Right Align" style="background-position: 34px -480px;" ng-class="{\'pressed\': cursorStyle.alignment == \'right\'}" ng-click="execCommand(\'justifyright\')"></div>',blockJustify:'<div class="tinyeditor-control" title="Block Justify" style="background-position: 34px -510px;" ng-class="{\'pressed\': cursorStyle.alignment == \'justify\'}" ng-click="execCommand(\'justifyfull\')"></div>',orderedList:'<div class="tinyeditor-control" title="Insert Ordered List" style="background-position: 34px -300px;" ng-click="execCommand(\'insertorderedlist\')"></div>',unorderedList:'<div class="tinyeditor-control" title="Insert Unordered List" style="background-position: 34px -330px;" ng-click="execCommand(\'insertunorderedlist\')"></div>',outdent:'<div class="tinyeditor-divider"></div><div class="tinyeditor-control" title="Outdent" style="background-position: 34px -360px;" ng-click="execCommand(\'outdent\')"></div>',indent:'<div class="tinyeditor-control" title="Indent" style="background-position: 34px -390px;" ng-click="execCommand(\'indent\')"></div>',removeFormatting:'<div class="tinyeditor-control" title="Remove Formatting" style="background-position: 34px -720px;" ng-click="execCommand(\'removeformat\')"></div>',undo:'<div class="tinyeditor-control" title="Undo" style="background-position: 34px -540px;" ng-click="execCommand(\'undo\')"></div>',redo:'<div class="tinyeditor-control" title="Redo" style="background-position: 34px -570px;" ng-click="execCommand(\'redo\')"></div>',fontColor:'<div class="tinyeditor-control" title="Font Color" style="background-position: 34px -779px; position: relative;" ng-click="showFontColors = !showFontColors"><colors-grid show="showFontColors" on-pick="setFontColor(color)"><colors-grid></div>',backgroundColor:'<div class="tinyeditor-control" title="Background Color" style="background-position: 34px -808px; position: relative;" ng-click="showBgColors = !showBgColors"><colors-grid show="showBgColors" on-pick="setBgColor(color)"><colors-grid></div>',image:'<div class="tinyeditor-control" title="Insert Image" style="background-position: 34px -600px;" ng-click="insertImage()"></div>',hr:'<div class="tinyeditor-control" title="Insert Horizontal Rule" style="background-position: 34px -630px;" ng-click="execCommand(\'inserthorizontalrule\')"></div>',symbols:'<div class="tinyeditor-control" title="Insert Special Symbol" style="background-position: 34px -838px; position: relative;" ng-click="showSpecChars = !showSpecChars"><symbols-grid show="showSpecChars" on-pick="insertSpecChar(symbol)"><symbols-grid></div>',link:'<div class="tinyeditor-control" title="Insert Hyperlink" style="background-position: 34px -660px;" ng-click="insertLink()"></div>',unlink:'<div class="tinyeditor-control" title="Remove Hyperlink" style="background-position: 34px -690px;" ng-click="execCommand(\'unlink\')"></div>',print:'<div class="tinyeditor-control" title="Print" style="background-position: 34px -750px;" ng-click="execCommand(\'print\')"></div>',font:'<select class="tinyeditor-font" ng-model="font" ng-options="a as a for a in fonts" ng-change="fontChange()"><option value="">Font</option></select>',size:'<select class="tinyeditor-size" ng-model="fontsize" ng-options="a.key as a.name for a in fontsizes" ng-change="sizeChange()"><option value="">Size</option></select>',format:'<select class="tinyeditor-style" ng-model="textstyle" ng-options="s.key as s.name for s in styles" ng-change="styleChange()"><option value="">Style</option></select>'},scope.toolbar=scope.config&&scope.config.toolbar?scope.config.toolbar:[{name:"basicStyling",items:["bold","italic","underline","strikethrough","subscript","superscript","leftAlign","centerAlign","rightAlign","blockJustify","-"]},{name:"paragraph",items:["orderedList","unorderedList","outdent","indent","-"]},{name:"doers",items:["removeFormatting","undo","redo","-"]},{name:"colors",items:["fontColor","backgroundColor","-"]},{name:"links",items:["image","hr","symbols","link","unlink","-"]},{name:"tools",items:["print","-"]},{name:"styling",items:["font","size","format"]}];var toolbarGroups=[];angular.forEach(scope.toolbar,function(buttonGroup,index){var buttons=[];angular.forEach(buttonGroup.items,function(button,index){this.push(scope.panelButtons[button])},buttons),this.push('<div class="tinyeditor-buttons-group">'+buttons.join("")+"</div>")},toolbarGroups);var template=editorTemplate.replace("{toolbar}",toolbarGroups.join(""));template=template.replace("{contentStyle}",attrs.contentStyle||""),$element.html(template),$compile($element.contents())(scope),scope.execCommand=function(cmd,arg){switch(cmd){case"bold":scope.cursorStyle.bold=!scope.cursorStyle.bold;break;case"italic":scope.cursorStyle.italic=!scope.cursorStyle.italic;break;case"underline":scope.cursorStyle.underline=!scope.cursorStyle.underline;break;case"strikethrough":scope.cursorStyle.strikethrough=!scope.cursorStyle.strikethrough;break;case"subscript":scope.cursorStyle.sub=!scope.cursorStyle.sub;break;case"superscript":scope.cursorStyle["super"]=!scope.cursorStyle["super"];break;case"justifyleft":scope.cursorStyle.alignment="left";break;case"justifycenter":scope.cursorStyle.alignment="center";break;case"justifyright":scope.cursorStyle.alignment="right";break;case"justifyfull":scope.cursorStyle.alignment="justify"}scope.$broadcast("execCommand",{command:cmd,arg:arg})},scope.fonts=["Verdana","Arial","Arial Black","Arial Narrow","Courier New","Century Gothic","Comic Sans MS","Georgia","Impact","Tahoma","Times","Times New Roman","Webdings","Trebuchet MS"],scope.fontChange=function(){scope.execCommand("fontname",scope.font)},scope.fontsizes=[{key:1,name:"x-small"},{key:2,name:"small"},{key:3,name:"normal"},{key:4,name:"large"},{key:5,name:"x-large"},{key:6,name:"xx-large"},{key:7,name:"xxx-large"}],scope.mapFontSize={10:1,13:2,16:3,18:4,24:5,32:6,48:7},scope.sizeChange=function(){scope.execCommand("fontsize",scope.fontsize)},scope.styles=[{name:"Paragraph",key:"<p>"},{name:"Header 1",key:"<h1>"},{name:"Header 2",key:"<h2>"},{name:"Header 3",key:"<h3>"},{name:"Header 4",key:"<h4>"},{name:"Header 5",key:"<h5>"},{name:"Header 6",key:"<h6>"}],scope.styleChange=function(){scope.execCommand("formatblock",scope.fontsize)},scope.showFontColors=!1,scope.setFontColor=function(color){scope.execCommand("foreColor",color)},scope.showBgColors=!1,scope.setBgColor=function(color){scope.execCommand("hiliteColor",color)},scope.showSpecChars=!1,scope.insertSpecChar=function(symbol){scope.execCommand("insertHTML",symbol)},scope.insertLink=function(){var val=prompt("Please enter the URL","http://");val&&scope.execCommand("createlink",val)},scope.insertImage=function(){var val;scope.api&&scope.api.insertImage&&angular.isFunction(scope.api.insertImage)?val=scope.api.insertImage.apply(scope.api.scope||null):(val=prompt("Please enter the picture URL","http://"),val='<img src="'+val+'">'),$q.when(val).then(function(data){scope.execCommand("insertHTML",data)})},$element.ready(function(){function makeUnselectable(node){1==node.nodeType&&(node.setAttribute("unselectable","on"),node.unselectable="on");for(var child=node.firstChild;child;)makeUnselectable(child),child=child.nextSibling}for(var i=0;i<document.getElementsByClassName("tinyeditor-header").length;i+=1)makeUnselectable(document.getElementsByClassName("tinyeditor-header")[i])}),scope.$on("cursor-position",function(event,data){scope.cursorStyle=data,scope.font=data.font.replace(/(')/g,""),scope.fontsize=scope.mapFontSize[data.size]?scope.mapFontSize[data.size]:0})};return{link:linker,scope:{content:"=",api:"=",config:"="},restrict:"AE",replace:!0}}])}(window.angular);